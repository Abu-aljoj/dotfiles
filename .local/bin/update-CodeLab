#!/usr/bin/env zsh
set -euo pipefail

# === CONFIGURATION ===
REPO="${REPO_PATH:-$HOME/CodeLab}"

# === COLORS ===
GREEN=$'\033[0;32m'
YELLOW=$'\033[1;33m'
RED=$'\033[0;31m'
RESET=$'\033[0m'

# === FUNCTIONS ===
log()   { echo "${GREEN}[✔]${RESET} $1"; }
warn()  { echo "${YELLOW}[!]${RESET} $1"; }
error() { echo "${RED}[✖]${RESET} $1" >&2; }

# === CHECK REPO ===
if [[ ! -d "$REPO" ]]; then
  error "Repo not found at $REPO"
  exit 1
fi

log "[1/3] Staging changes..."
cd "$REPO"
git add .

log "[2/3] Enter commit message (leave blank to auto-generate):"
read -r COMMIT_MSG

if [[ -z "$COMMIT_MSG" ]]; then
  COMMIT_MSG="Update: $(date '+%Y-%m-%d %H:%M:%S')"
  warn "Using default commit message: \"$COMMIT_MSG\""
fi

log "[3/3] Committing and pushing..."
git commit -m "$COMMIT_MSG"
git push

log "Repo updated and pushed successfully!"
