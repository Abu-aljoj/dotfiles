#!/bin/sh

# Set working repo path
REPO="$HOME/dotfiles"

# Exit if repo doesn't exist
if [ ! -d "$REPO" ]; then
    echo "Dotfiles repo not found at $REPO"
    exit 1
fi

echo "[1/4] Copying selected config folders..."

# List of config folders to copy
CONFIG_FOLDERS="fastfetch kitty hypr uwsm hyprpanel rofi nvim"

# Ensure the destination config directory exists
mkdir -p "$REPO/.config"

# Copy each folder individually
for folder in $CONFIG_FOLDERS; do
    SRC="$HOME/.config/$folder"
    DEST="$REPO/.config/$folder"

    if [ -d "$SRC" ]; then
        # Remove existing folder in repo before copying
        rm -rf "$DEST"
        cp -r "$SRC" "$DEST"
        echo "Copied $folder"
    else
        echo "Warning: $SRC does not exist, skipping."
    fi
done

echo "[2/4] Adding changes to Git..."
cd "$REPO" || exit 1
git add .

echo "[3/4] Enter your commit message:"
read -r COMMIT_MSG

# Exit if message is empty
if [ -z "$COMMIT_MSG" ]; then
    echo "Commit message cannot be empty. Aborting."
    exit 1
fi

echo "[4/4] Committing and pushing..."
git commit -m "$COMMIT_MSG"
git push

echo "Dotfiles updated and pushed with message: $COMMIT_MSG"

